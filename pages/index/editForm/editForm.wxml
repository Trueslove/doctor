<view class="edit-form">
    <back></back>
    <backTop></backTop>
    <chatTemplate wx:if="{{isShowChat}}" inputValue="{{inputValue}}" bind:getMessage="getMessage" bind:getAuditUrl="getAuditUrl" bind:getImgUrl="getImgUrl" bind:getVideoUrl="getVideoUrl"></chatTemplate>
    <view class="detail-header">
        <image class="detail-h-j" src="/images/home/detailBj.png"></image>
        <view class="detail-h-txt">线上复诊</view>
    </view>
    <!-- ---------- 患者信息 ------------ -->
    <view class="edit-info-wap">
        <view class="edit-info-user">
            <view class="edit-user-l-wap">
                <image class="edit-user-left" src="{{dataInfo.avatar}}"></image>
            </view>
            <view class="edit-user-right">
                <view class="edit-user-100 edit-user-flex">
                    <view class="edit-user-name">{{dataInfo.patientName}}</view>
                    <view class="edit-user-flex-name">
                        <view class="edit-user-job">医助</view>
                        <view class="edit-user-job-name">{{dataInfo.consultantName}}</view>
                    </view>
                </view>
                <view class="edit-user-100" style="margin-top:6rpx">
                    {{dataInfo.sex == 1 ? '男' : '女'}} {{dataInfo.age}}岁 {{dataInfo.phone}}
                </view>
                <view class="edit-user-100 edit-user-flex edit-user-between">
                    <view>{{dataInfo.birthday}}</view>
                </view>
            </view>
        </view>
        <view wx:if="{{loginType != '2'}}" class="edit-info-cell" data-url="/pages/index/history/history" catchtap="handleToPage">
            <view class="edit-info-cell-label">查看历史病例</view>
            <image class="edit-info-cell-arrow" src="/images/home/arrow.png" />
        </view>
        <view wx:if="{{loginType != '2'}}" class="edit-info-cell" data-url="/pages/chat/chat" catchtap="handleToPage">
            <view class="edit-info-cell-label">开始聊天</view>
            <image class="edit-info-cell-arrow" src="/images/home/arrow.png" />
        </view>
        <view wx:if="{{loginType != '2'}}" class="edit-info-cell">
            <view class="edit-info-cell-label">图文聊天</view>
            <view class="edit-info-cell-switch">
                <view class="edit-switch-label" style="color:#4BD864;" wx:if="{{switch}}">已开启</view>
                <view class="edit-switch-label" wx:if="{{!switch}}">未开启</view>
                <switch checked="{{switch}}" data-url="/pages/chat/chat" bindchange="changeSwitch" />
            </view>
        </view>
        <!-- <view class="" catch:tap="handleSend">fjlkfsdja1</view> -->
        <!-- 聊天信息 -->
        <view class="detail-chat-wap">
            <view class="detail-c-info">
                <view class="detail-c-i-border"></view>
                <view class="detail-c-title">线上复诊资料</view>
            </view>
            <view wx:for="{{chatList}}">
                <view>
                    <!-- ------- 照片信息 ---------- -->
                    <view class="detail-chat-txt detail-chat-txt-flex">
                        <view class="detail-chat-txt-left">{{item.title}}</view>
                    </view>
                    <image class="edit-form-info-img" src="{{item.url}}" />
                </view>
                <view class="detail-chat-cell detail-chat-left">
                    <image class="detail-chat-img" src="{{dataInfo.avatar}}"></image>
                    <view class="detail-chat-info">
                        <view class="detail-chat-name">{{dataInfo.patientName}}</view>
                        <!-- ------- 聊天信息 ---------- -->
                        <view class="detail-chat-info-cell">{{item.user_content}}</view>
                        <view class="detail-docker-right">
                            <view wx:if="{{item.doctor_type == 0}}" class="detail-chat-txt detail-chat-l-txt">
                                {{item.doctor_content}}
                            </view>
                            <view wx:if="{{item.doctor_type == 1}}" class="detail-chat-txt detail-chat-l-txt">
                                <image class="detail-h-j-img" src="{{item.doctor_content}}"></image>
                            </view>
                            <view wx:if="{{item.doctor_type == 2}}" class="detail-chat-txt detail-chat-l-txt">
                                <view class="chat-content-list-voice" catch:tap="audioPlay" data-index="{{index}}" data-url="{{item.doctor_content}}">
                                    <image mode='aspectFit' class="chat-voice-img" style="margin-right:15rpx" src='{{item.doctor_content === audioUrl ? "/images/audioright.gif" : "/images/audioright.png"}}'></image>
                                    <text class="chat-voice-text">{{item.time}}</text>
                                </view>
                                <view class="chat-content-list-voice" catch:tap="audioStop" data-index="{{index}}" wx:if="{{item.isPlay}}">
                                    <image class="chat-voice-img" style="margin-right:15rpx" src="/images/chat/wifi.gif"></image>
                                    <text class="chat-voice-text">播放中</text>
                                </view>
                            </view>
                            <view wx:if="{{item.doctor_type == 3}}" class="detail-chat-txt detail-chat-l-txt">
                                <video class="detail-h-j-img" src="{{item.doctor_content}}"></video>
                            </view>
                            <image class="detail-chat-img" style="margin-left: 15rpx" src="{{dataInfo.doctor_avatar}}"></image>
                        </view>
                    </view>
                </view>
                <view catch:tap="handleHf" wx:if="{{loginType != '2'}}" data-type="{{item.doctor_type}}" data-content="{{item.doctor_content}}" data-index="{{index}}" class="detail-chat-txt-r detail-txt-flex-c detail-chat-txt-flex">
                    <image class="edit-info-cell-hf" src="/images/home/hf.png" />
                    <view style="margin-left:14rpx">{{item.doctor_content ? '重新录入' : '回复'}}</view>
                </view>
            </view>
        </view>
        <!-- --------- 最终意见 ----------- -->
        <view class="detail-chat-wap" wx:if="{{loginType != '2'}}" style="position: relative;">
            <view class="detail-c-info edit-form-flex-c">
                <view class="detail-c-i-border"></view>
                <view class="detail-c-title">最终意见</view>
            </view>
            <view class="detail-chat-txt detail-chat-txt-flex" style="position: relative;">
                <view class="detail-chat-txt-left edit-form-content" style="padding-bottom: 20rpx;">
                    <view wx:if="{{doctor_desc_type == 0}}" class="detail-chat-txt detail-chat-l-txt">
                        {{doctor_desc}}
                    </view>
                    <view wx:if="{{doctor_desc_type == 1}}">
                        <image class="detail-h-j-img" src="{{doctor_desc}}"></image>
                    </view>
                    <view wx:if="{{doctor_desc_type == 2}}" class="detail-chat-txt detail-chat-l-txt">
                        <view class="chat-content-list-voice" catch:tap="audioPlay" data-type="doctor_desc" data-url="{{doctor_desc}}">
                            <image mode='aspectFit' class="chat-voice-img" style="margin-right:15rpx" src='{{doctor_desc === audioUrl ? "/images/audioright.gif" : "/images/audioright.png"}}'></image>
                            <text class="chat-voice-text">{{doctor_desc_time}}</text>
                        </view>
                    </view>
                    <view wx:if="{{doctor_desc_type == 3}}" class="detail-chat-txt detail-chat-l-txt">
                        <video class="detail-h-j-img" src="{{doctor_desc}}"></video>
                    </view>
                </view>
            </view>
            <view catch:tap="handleZzHf" wx:if="{{loginType != '2'}}" data-type="{{doctor_desc_type}}" data-content="{{doctor_desc}}" class="detail-chat-txt-r detail-txt-flex-c detail-chat-txt-flex edit-form-hf" style="position: relative;">
                <image class="edit-info-cell-hf" src="/images/home/hf.png" />
                <view style="margin-left:14rpx">{{doctor_desc ? '重新录入' : '回复'}}</view>
            </view>
        </view>
        <!-- --------- 下次复诊预约 ----------- -->
        <view class="detail-chat-wap" wx:if="{{loginType != '2'}}">
            <view class="detail-c-info edit-form-flex-c" style="padding-bottom:15rpx">
                <view class="detail-c-i-border"></view>
                <view class="detail-c-title">下次复诊预约</view>
            </view>
            <view class="edit-form-cell-wap">
                <view class="edit-form-cell">
                    <view class="edit-cell-label">复诊时间:</view>
                    <view class="edit-cell-input" style="position: relative;">
                        <date-time-picker style="flex:1;z-index:1" value="{{next_time}}" bind:change="handleChange">
                            {{next_time}}
                        </date-time-picker>
                        <view style="color:#006AEF" class="edit-cell-input-yy" bind:change="handleChange">
                            预约
                        </view>
                    </view>
                </view>
                <view class="edit-form-cell">
                    <view class="edit-cell-label">复诊项目:</view>
                    <view class="edit-cell-input">
                        <input class="edit-input" value="{{next_product}}" bind:input="handleInputPro" data-key="next_product" placeholder-class="input-placeholder" placeholder="请输入" type="text" />
                    </view>
                </view>
                <view class="edit-form-cell">
                    <view class="edit-cell-label">复诊方式:</view>
                    <view class="edit-cell-type-wap">
                        <view data-index="0" bindtap="handleChangeType" class="edit-cell-type {{activeIndex == 0 ? 'edit-type-active' : ''}}">
                            线上
                        </view>
                        <view data-index="1" bindtap="handleChangeType" class="edit-cell-type {{activeIndex == 1 ? 'edit-type-active' : ''}}">
                            线下
                        </view>
                    </view>
                </view>
            </view>
        </view>
        <!-- --------- 线上复诊病例 ----------- -->
        <view class="detail-chat-wap" wx:if="{{loginType != '2'}}">
            <view class="detail-c-info edit-form-flex-c" style="padding-bottom:15rpx">
                <view class="detail-c-i-border"></view>
                <view class="detail-c-title">线上复诊病例</view>
            </view>
            <view class="edit-form-cell-wap">
                <view class="edit-form-cell">
                    <view class="edit-cell-label">主诉:</view>
                    <view class="edit-cell-input">
                        <input class="edit-input" value="{{onlineInfo.chief_complaint}}" bind:input="handleInput" data-key="chief_complaint" placeholder-class="input-placeholder" placeholder="请输入患者主诉" type="text" />
                    </view>
                </view>
                <view class="edit-form-cell">
                    <view class="edit-cell-label">检查:</view>
                    <view class="edit-cell-input">
                        <input class="edit-input" value="{{onlineInfo.examination}}" bind:input="handleInput" data-key="examination" placeholder-class="input-placeholder" placeholder="请输入检查情况" type="text" />
                    </view>
                </view>
                <view class="edit-form-cell">
                    <view class="edit-cell-label">诊断:</view>
                    <view class="edit-cell-input">
                        <input class="edit-input" value="{{onlineInfo.diagnosis}}" bind:input="handleInput" data-key="diagnosis" placeholder-class="input-placeholder" placeholder="请输入诊断内容" type="text" />
                    </view>
                </view>
                <view class="edit-form-cell">
                    <view class="edit-cell-label">处置:</view>
                    <view class="edit-cell-input">
                        <input class="edit-input" value="{{onlineInfo.dispose}}" bind:input="handleInput" data-key="dispose" placeholder-class="input-placeholder" placeholder="请输入处置内容" type="text" />
                    </view>
                </view>
                <view class="edit-form-cell">
                    <view class="edit-cell-label">医嘱:</view>
                    <view class="edit-cell-input">
                        <input class="edit-input" value="{{onlineInfo.doctor_order}}" bind:input="handleInput" data-key="doctor_order" placeholder-class="input-placeholder" placeholder="请输入医嘱内容" type="text" />
                    </view>
                </view>
                <view class="edit-form-copy" catchtap="getTopFollow">复制上次线上复诊病例</view>
            </view>
        </view>
        <view wx:if="{{loginType != '2'}}" class="btn edit-info-btn" data-type="0" catch:tap="handleSave">
            完成复诊
        </view>
        <view wx:if="{{loginType != '2'}}" class="btn edit-info-btn" data-type="1" catch:tap="handleSave" style="background: #D3D3D3">
            保存草稿
        </view>
        <view wx:if="{{loginType == '2' && dataInfo.is_chat == 0}}" class="btn edit-info-btn" data-type="1" style="background: #D3D3D3">
            点击查看沟通记录
        </view>
        <view wx:if="{{loginType == '2' && dataInfo.is_chat == 1}}" class="btn edit-info-btn" data-url="/pages/index/detail/detail" catch:tap="handleToPage">
            点击查看沟通记录
        </view>
    </view>
</view>